<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modern Water Vendo Monitoring Dashboard</title>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f8fafc;
      color: #1f2937;
      line-height: 1.6;
      min-height: 100vh;
      display: block;
      overflow-x: hidden;
    }

    /* Authentication Panel Styles (Updated for Gmail-Only Auth) */
.auth-container {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
}

.auth-container.hidden {
  display: none;
}

.auth-panel {
  background: white;
  border-radius: 16px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  padding: 40px;
  width: 100%;
  max-width: 420px;
  position: relative;
}

.auth-header {
  text-align: center;
  margin-bottom: 32px;
}

.auth-title {
  font-size: 26px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 8px;
}

.auth-subtitle {
  font-size: 15px;
  color: #6b7280;
  margin-bottom: 20px;
}

.auth-tabs {
  display: flex;
  background: #f3f4f6;
  border-radius: 12px;
  padding: 4px;
  margin-bottom: 32px;
}

.auth-tab {
  flex: 1;
  padding: 12px 16px;
  text-align: center;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  font-size: 14px;
  color: #6b7280;
  transition: all 0.2s ease;
  border: none;
  background: transparent;
}

.auth-tab.active {
  background: white;
  color: #2563eb;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}
.auth-container.hidden {
  display: none !important;
}
.auth-form {
  display: none;
  flex-direction: column;
  gap: 16px;
}

.auth-form.active {
  display: flex;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.form-label {
  font-size: 14px;
  font-weight: 500;
  color: #374151;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  font-size: 15px;
  transition: 0.2s ease;
}

.form-input:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  outline: none;
}

.auth-button {
  width: 100%;
  padding: 12px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s ease;
}

.auth-button:hover {
  background: #1d4ed8;
}

.auth-error {
  background: #fee2e2;
  border: 1px solid #fecaca;
  color: #991b1b;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.auth-success {
  background: #d1fae5;
  border: 1px solid #a7f3d0;
  color: #065f46;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.auth-link {
  text-align: center;
  margin-top: 16px;
  font-size: 14px;
  color: #6b7280;
}

.auth-link button {
  background: none;
  border: none;
  color: #2563eb;
  cursor: pointer;
  text-decoration: underline;
  font-size: 14px;
}
.auth-link button:hover {
  color: #1d4ed8;
}


    /* Main Dashboard Container */
    .dashboard-container {
      display: none;
    }

    .dashboard-container.visible {
      display: block;
    }

    /* Logout Button */
    .logout-btn {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 60;
      background: #dc2626;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .logout-btn:hover {
      background: #b91c1c;
    }

    /* Overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 40;
      opacity: 0;
      visibility: hidden;
      transition: opacity .3s ease, visibility .3s ease;
    }
    .overlay.active { opacity: 1; visibility: visible; }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 250px;
      height: 100vh;
      background: white;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      z-index: 50;
      transform: translateX(0);
      transition: transform 0.3s ease;
    }

    .sidebar.open { transform: translateX(0); }

    .sidebar-header { padding: 24px; border-bottom: 1px solid #e5e7eb; }
    .sidebar-title {
      font-size: 20px; font-weight: 700; color: #1f2937;
      display: flex; align-items: center; gap: 8px;
    }

    .sidebar-nav { padding: 16px; overflow-y: auto; }
    .nav-item {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 16px; margin-bottom: 6px;
      border-radius: 8px; text-decoration: none; color: #6b7280;
      font-weight: 500; transition: all .15s ease; cursor: pointer;
    }
    .nav-item:hover { background: #f3f4f6; color: #374151; }
    .nav-item.active { background: #dbeafe; color: #2563eb; border-right: 2px solid #2563eb; }

    /* Mobile menu button */
    .mobile-menu-btn {
      position: fixed; 
      top: 16px; 
      left: 16px; 
      z-index: 60;
      background: #2563eb; 
      color: white; 
      border: none;
      padding: 8px; 
      border-radius: 8px; 
      cursor: pointer;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,.1);
      display: none;
      width: 44px;
      height: 44px;
      justify-content: center;
      align-items: center;
    }

    /* Main content */
    .main {
      padding: 16px;
      margin-left: 250px;
      min-height: 100vh;
    }

    .main-header {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
      flex-wrap: wrap;
    }
    .main-title { font-size: 28px; font-weight: 700; color: #1f2937; }
    .last-updated { font-size: 14px; color: #6b7280; }

    /* Cards Grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,.06);
      border: 1px solid #e5e7eb;
      margin-bottom: 16px;
      min-width: 0;
    }

    .card:hover { box-shadow: 0 6px 18px rgba(0,0,0,.06); }

    .card-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 16px; 
      gap: 12px; 
      flex-wrap: wrap;
    }
    .card-title { font-size: 14px; font-weight: 500; color: #6b7280; margin-bottom: 4px; }
    .card-value { font-size: 24px; font-weight: 700; word-break: break-word; }
    .card-subtitle { font-size: 12px; color: #9ca3af; margin-top: 4px; }

    .card-icon { padding: 12px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

    /* Color variants */
    .text-blue { color: #2563eb; } .bg-blue { background: #dbeafe; }
    .text-green { color: #059669; } .bg-green { background: #d1fae5; }
    .text-purple { color: #7c3aed; } .bg-purple { background: #e9d5ff; }
    .text-orange { color: #ea580c; } .bg-orange { background: #fed7aa; }
    .text-cyan { color: #0891b2; } .bg-cyan { background: #cffafe; }
    .text-red { color: #dc2626; }

    /* Progress bar */
    .progress-container { position: relative; width: 100%; height: 24px; background: #e5e7eb; border-radius: 12px; overflow: hidden; margin: 16px 0; }
    .progress-bar {
      height: 100%; background: linear-gradient(to right,#3b82f6,#06b6d4);
      display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600;
      transition: width .4s ease;
    }
    .progress-bar.low { background: linear-gradient(to right,#f59e0b,#eab308); }
    .progress-bar.empty { background: linear-gradient(to right,#ef4444,#dc2626); }

    /* Buttons */
    .btn { 
      display: inline-flex; 
      align-items: center; 
      gap: 8px; 
      padding: 8px 16px; 
      border-radius: 8px; 
      cursor: pointer; 
      border: none; 
      font-size: 14px;
      white-space: nowrap;
    }
    .btn-primary { background: #2563eb; color: white; } .btn-primary:hover { background: #1d4ed8; }
    .btn-secondary { background: #f3f4f6; color: #374151; } .btn-secondary:hover { background: #e5e7eb; }
    .btn-danger { background: #dc2626; color: white; } .btn-danger:hover { background: #b91c1c; }

    /* Controls */
    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 16px;
    }

    /* Slider */
    .slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #e5e7eb;
      outline: none;
      margin: 16px 0;
    }

    /* Table */
    .table-container { 
      overflow-x: auto; 
      border-radius: 8px; 
      border: 1px solid #e5e7eb; 
      -webkit-overflow-scrolling: touch;
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      min-width: 600px;
    }
    th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #e5e7eb; }
    th { background: #f9fafb; font-weight: 500; color: #6b7280; font-size: 14px; white-space: nowrap; }
    td { font-size: 14px; }

    /* Alerts */
    .alert { 
      padding: 16px; 
      border-radius: 8px; 
      border-left: 4px solid; 
      margin: 16px 0; 
      display: flex; 
      gap: 12px; 
      align-items: flex-start;
    }
    .alert-warning { background: #fef3c7; border-color: #f59e0b; color: #92400e; }
    .alert-danger { background: #fee2e2; border-color: #ef4444; color: #991b1b; }

    /* Sections */
    .section { display: none; }
    .section.active { display: block; }

    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 16px;
      }
      
      .main {
        margin-left: 250px;
        padding: 12px;
      }
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
      }

      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main {
        margin-left: 0;
        padding: 60px 12px 12px 12px;
      }

      .main-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .main-title {
        font-size: 24px;
      }

      .cards-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .card {
        padding: 16px;
      }

      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .controls {
        flex-direction: column;
        gap: 8px;
      }

      .controls .btn {
        justify-content: center;
        width: 100%;
      }

      table {
        min-width: 500px;
      }

      th, td {
        padding: 8px 12px;
        font-size: 13px;
      }

      /* Auth panel responsive */
      .auth-panel {
        padding: 24px;
        margin: 16px;
      }

      .auth-title {
        font-size: 24px;
      }

      .logout-btn {
        top: 60px;
        right: 12px;
        font-size: 12px;
        padding: 6px 10px;
      }
    }

    @media (max-width: 640px) {
      .main {
        padding: 60px 8px 8px 8px;
      }

      .card-value {
        font-size: 20px;
      }

      .main-title {
        font-size: 20px;
      }

      .cards-grid {
        gap: 8px;
      }

      .card {
        padding: 12px;
      }

      .auth-panel {
        padding: 20px;
      }

      .auth-tabs {
        flex-direction: column;
        gap: 4px;
      }

      .auth-tab {
        padding: 10px 12px;
      }
    }

    @media (max-width: 480px) {
      .main-header {
        margin-bottom: 16px;
      }

      .card-header {
        gap: 4px;
      }

      .controls {
        gap: 6px;
      }

      .btn {
        padding: 6px 12px;
        font-size: 13px;
      }

      table {
        min-width: 450px;
      }

      th, td {
        padding: 6px 8px;
        font-size: 12px;
      }

      .auth-panel {
        padding: 16px;
      }

      .auth-title {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Authentication Container -->
  <div class="auth-container" id="authContainer">
    <div class="auth-panel">
      <div class="auth-header">
        <div class="auth-logo">
          <i data-lucide="droplets"></i>
          <span style="font-size: 20px; font-weight: 700; color: #2563eb;">Water Vendo</span>
        </div>
        <h1 class="auth-title">Admin Access</h1>
        <p class="auth-subtitle">Secure dashboard management</p>
      </div>

      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
        <button class="auth-tab" onclick="switchAuthTab('register')">Create Account</button>
        <button class="auth-tab" onclick="switchAuthTab('forgot')">Forgot Password</button>
      </div>

     <!-- Authentication Forms -->
<form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
  <div class="form-group">
    <label class="form-label" for="loginEmail">Gmail Address</label>
    <input type="email" id="loginEmail" class="form-input" placeholder="name@gmail.com" required />
  </div>
  <div class="form-group">
    <label class="form-label" for="loginPassword">Password</label>
    <input type="password" id="loginPassword" class="form-input" placeholder="Enter password" required />
  </div>
  <button type="submit" class="auth-button">Login</button>
</form>

<form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
  <div class="form-group">
    <label class="form-label" for="registerEmail">Gmail Address</label>
    <input type="email" id="registerEmail" class="form-input" placeholder="name@gmail.com" required />
  </div>
  <div class="form-group">
    <label class="form-label" for="registerPassword">Password</label>
    <input type="password" id="registerPassword" class="form-input" placeholder="Min 6 characters" required />
  </div>
  <div class="form-group">
    <label class="form-label" for="confirmPassword">Confirm Password</label>
    <input type="password" id="confirmPassword" class="form-input" placeholder="Re-enter password" required />
  </div>
  <button type="submit" class="auth-button">Create Account</button>
</form>

<form id="forgotForm" class="auth-form" onsubmit="handleForgotPassword(event)">
  <div class="form-group">
    <label class="form-label" for="forgotEmail">Gmail Address</label>
    <input type="email" id="forgotEmail" class="form-input" placeholder="name@gmail.com" required />
  </div>
  <button type="submit" class="auth-button">Send Reset Link</button>
</form>
</div>
</div>
  <!-- Dashboard Container -->
  <div class="dashboard-container" id="dashboardContainer">
    <!-- Logout Button -->
    <button class="logout-btn" onclick="logout()">
      <i data-lucide="log-out"></i>
      Logout
    </button>

    <!-- Mobile menu button -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()" aria-label="Toggle menu">
      <i data-lucide="menu"></i>
    </button>

    <!-- Overlay -->
    <div class="overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" aria-hidden="false">
      <div class="sidebar-header">
        <div class="sidebar-title">
          <i data-lucide="droplets"></i>
          <span>Water Vendo</span>
        </div>
      </div>

      <nav class="sidebar-nav" aria-label="Main navigation">
        <a class="nav-item active" onclick="showSection('dashboard', this)"><i data-lucide="layout-dashboard"></i> Dashboard</a>
        <a class="nav-item" onclick="showSection('water', this)"><i data-lucide="droplets"></i> Water Level</a>
        <a class="nav-item" onclick="showSection('sales', this)"><i data-lucide="coins"></i> Sales Report</a>
        <a class="nav-item" onclick="showSection('history', this)"><i data-lucide="history"></i> History</a>
        <a class="nav-item" onclick="showSection('settings', this)"><i data-lucide="settings"></i> Settings</a>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="main" role="main">
      <!-- Dashboard Section -->
      <section id="dashboard" class="section active">
        <header class="main-header">
          <div>
            <h1 class="main-title">Dashboard</h1>
            <div class="last-updated" id="lastUpdated">Last updated: --</div>
          </div>
          <div style="align-self:center;">
            <div style="font-size:14px;color:#6b7280;">Quick stats</div>
          </div>
        </header>

        <div class="cards-grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">â‚±1 Coins</div>
                <div class="card-value text-blue" id="peso1Display">0</div>
                <div class="card-subtitle">â‚±<span id="peso1Total">0</span> total</div>
              </div>
              <div class="card-icon bg-blue"><i data-lucide="coins" class="text-blue"></i></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">â‚±5 Coins</div>
                <div class="card-value text-green" id="peso5Display">0</div>
                <div class="card-subtitle">â‚±<span id="peso5Total">0</span> total</div>
              </div>
              <div class="card-icon bg-green"><i data-lucide="coins" class="text-green"></i></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">â‚±10 Coins</div>
                <div class="card-value text-purple" id="peso10Display">0</div>
                <div class="card-subtitle">â‚±<span id="peso10Total">0</span> total</div>
              </div>
              <div class="card-icon bg-purple"><i data-lucide="coins" class="text-purple"></i></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Total Earnings</div>
                <div class="card-value text-orange" id="totalEarningsDisplay">â‚±0</div>
                <div class="card-subtitle"><span id="totalCoins">0</span> coins</div>
              </div>
              <div class="card-icon bg-orange"><i data-lucide="dollar-sign" class="text-orange"></i></div>
            </div>
          </div>
        </div>

        <div class="cards-grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Water Status</div>
                <div class="card-value text-cyan" id="waterStatusDisplay">85%</div>
                <div class="card-subtitle">Tank level</div>
              </div>
              <div class="card-icon bg-cyan"><i data-lucide="droplets" class="text-cyan"></i></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">System Alerts</div>
                <div class="card-value text-green">0</div>
                <div class="card-subtitle">All systems operational</div>
              </div>
              <div class="card-icon bg-green"><i data-lucide="check-circle" class="text-green"></i></div>
            </div>
          </div>
        </div>

       <div class="card">
  <h3 style="margin-bottom:16px;color:#1f2937;">Quick Actions</h3>
  <div class="controls">
    <button class="btn btn-primary" onclick="resetCounters()">
      <i data-lucide="refresh-cw"></i> Reset Counters
    </button>

    <button class="btn btn-secondary" onclick="exportHistory()">
      <i data-lucide="download"></i> Export Data
    </button>

    <button class="btn btn-secondary">
      <i data-lucide="file-text"></i> View Reports
    </button>
  </div>
</div>

      </section>

      <!-- Water Level Section -->
      <section id="water" class="section" aria-labelledby="water-heading">
        <header class="main-header">
          <h1 class="main-title">Water Level Monitoring</h1>
        </header>

        <div class="cards-grid">
          <div class="card">
            <div class="card-header">
              <h3 style="color:#1f2937;">Tank Status</h3>
              <i data-lucide="check-circle" class="text-green" id="waterStatusIcon"></i>
            </div>

            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                <span style="font-size:14px;color:#6b7280;">Current Level</span>
                <span class="text-cyan" style="font-size:24px;font-weight:700;" id="waterLevelDisplay">85%</span>
              </div>

              <div class="progress-container">
                <div class="progress-bar" id="waterProgressBar" style="width:85%;">85%</div>
              </div>

              <div style="text-align:center;margin-top:8px;">
                <span style="font-size:14px;font-weight:500;color:#059669;" id="waterStatusText">Status: normal</span>
              </div>
            </div>
          </div>

          
        </div>

        <div id="waterAlert"></div>
      </section>

      <!-- Sales Report Section -->
      <section id="sales" class="section">
        <header class="main-header">
          <h1 class="main-title">Sales Report</h1>
          <div class="controls">
            <button class="btn btn-primary"><i data-lucide="download"></i> Export</button>
            <button class="btn btn-danger" onclick="resetCounters()"><i data-lucide="refresh-cw"></i> Reset</button>
          </div>
        </header>

        <div class="cards-grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Daily Total</div>
                <div class="card-value text-blue" id="dailyTotal">â‚±0</div>
              </div>
              <div class="card-icon bg-blue"><i data-lucide="bar-chart-3" class="text-blue"></i></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Weekly Total</div>
                <div class="card-value text-green" id="weeklyTotal">â‚±0</div>
              </div>
              <div class="card-icon bg-green"><i data-lucide="bar-chart-3" class="text-green"></i></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Monthly Total</div>
                <div class="card-value text-purple" id="monthlyTotal">â‚±0</div>
              </div>
              <div class="card-icon bg-purple"><i data-lucide="bar-chart-3" class="text-purple"></i></div>
            </div>
          </div>
        </div>

        <div class="card">
          <div style="padding-bottom:16px;border-bottom:1px solid #e5e7eb;margin-bottom:16px;">
            <h3 style="color:#1f2937;">Coin Breakdown</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Denomination</th>
                  <th style="text-align:right;">Count</th>
                  <th style="text-align:right;">Value</th>
                  <th style="text-align:right;">Percentage</th>
                </tr>
              </thead>
              <tbody id="salesBreakdown">
                <tr><td style="font-weight:500;">â‚±1 Coins</td><td style="text-align:right;" id="sales1Count">0</td><td style="text-align:right;" id="sales1Value">â‚±0</td><td style="text-align:right;" id="sales1Percent">0%</td></tr>
                <tr><td style="font-weight:500;">â‚±5 Coins</td><td style="text-align:right;" id="sales5Count">0</td><td style="text-align:right;" id="sales5Value">â‚±0</td><td style="text-align:right;" id="sales5Percent">0%</td></tr>
                <tr><td style="font-weight:500;">â‚±10 Coins</td><td style="text-align:right;" id="sales10Count">0</td><td style="text-align:right;" id="sales10Value">â‚±0</td><td style="text-align:right;" id="sales10Percent">0%</td></tr>
                <tr style="background:#f9fafb;font-weight:600;">
                  <td>Total</td>
                  <td style="text-align:right;" id="salesTotalCount">0</td>
                  <td style="text-align:right;" id="salesTotalValue">â‚±0</td>
                  <td style="text-align:right;">100%</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- History Section -->
      <section id="history" class="section">
        <header class="main-header">
          <h1 class="main-title">Transaction History</h1>
          <div><button class="btn btn-danger" onclick="clearHistory()"><i data-lucide="trash-2"></i> Clear History</button></div>
        </header>

        <div class="card">
          <div class="table-container" id="historyContainer">
            <div style="padding:48px;text-align:center;" id="emptyHistory">
              <i data-lucide="calendar" style="width:48px;height:48px;color:#9ca3af;margin-bottom:16px;"></i>
              <h3 style="color:#1f2937;margin-bottom:8px;">No Transaction History</h3>
              <p style="color:#6b7280;">Transaction history will appear here after you reset counters.</p>
            </div>

            <table id="historyTable" style="display:none;">
              <thead>
                <tr><th>Date & Time</th><th style="text-align:right;">â‚±1 Coins</th><th style="text-align:right;">â‚±5 Coins</th><th style="text-align:right;">â‚±10 Coins</th><th style="text-align:right;">Total Earnings</th></tr>
              </thead>
              <tbody id="historyTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings" class="section">
        <header class="main-header"><h1 class="main-title">Settings</h1></header>
        <div class="cards-grid">
          <div class="card">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <div class="card-icon bg-blue"><i data-lucide="settings" class="text-blue"></i></div>
              <h3 style="color:#1f2937;">System Configuration</h3>
            </div>
          </div>

          <div class="card">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <div class="card-icon bg-green"><i data-lucide="bell" class="text-green"></i></div>
              <h3 style="color:#1f2937;">Notifications</h3>
            </div>
            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <label>Low Water Level Alerts</label>
                <input type="checkbox" checked />
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <label>Daily Sales Reports</label>
                <input type="checkbox" checked />
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <label>System Maintenance Alerts</label>
                <input type="checkbox" />
              </div>
            </div>
          </div>
        </div>

        <div style="background:#dbeafe;border:1px solid #93c5fd;border-radius:12px;padding:16px;margin-top:24px;">
          <p style="color:#1e40af;font-size:14px;"><strong>Note:</strong> Settings will be implemented in future updates.</p>
        </div>
      </section>
    </main>
  </div>

 <!-- âœ… Firebase v8 SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* ------------------------------------------------------------------
   Firebase Configuration & Initialization
------------------------------------------------------------------ */
const firebaseConfig = {
  apiKey: "AIzaSyB1k4lZtq2ocuawaXzoN49GXkIJuzjZx2g",
  authDomain: "watervendo-1c55d.firebaseapp.com",
  databaseURL: "https://watervendo-1c55d-default-rtdb.firebaseio.com",
  projectId: "watervendo-1c55d",
  storageBucket: "watervendo-1c55d.appspot.com",
  messagingSenderId: "596510052097",
  appId: "1:596510052097:web:d3febf48f3a1b101119500",
  measurementId: "G-Y74371CWFX"
};
firebase.initializeApp(firebaseConfig);

// === LIVE DATA BINDINGS ===
const machineId = 'vendo1';        // <-- set your machine id here
const db = firebase.database();

firebase.auth().onAuthStateChanged(user => {
  if (user && user.emailVerified) {
    // show the app
    document.getElementById('authContainer').classList.add('hidden');
    document.getElementById('dashboardContainer').classList.add('visible');

    // Listen for water level
    db.ref(`machines/${machineId}/waterLevel`).on('value', snap => {
      const level = snap.val() ?? 0;
      setWaterLevel(Number(level));
    });

    // Listen for coins: expect { p1, p5, p10 }
    db.ref(`machines/${machineId}/coins`).on('value', snap => {
      const c = snap.val() || {};
      peso1 = Number(c.p1 || 0);
      peso5 = Number(c.p5 || 0);
      peso10 = Number(c.p10 || 0);
      updateDisplay();
    });
  } else {
    // show auth
    document.getElementById('authContainer').classList.remove('hidden');
    document.getElementById('dashboardContainer').classList.remove('visible');
  }
});

/* ------------------------------------------------------------------
   Authentication System
------------------------------------------------------------------ */
let currentUser = null;
let forgotPasswordStep = 1;

document.addEventListener('DOMContentLoaded', function() {
  const savedUser = localStorage.getItem('currentUser');
  if (savedUser) {
    currentUser = savedUser;
    showDashboard();
  }
  lucide.createIcons();
  init();

  // âŒ REMOVE these simulation timers
  // setInterval(simulateRandomInserts, 2000);
  // setInterval(updateLastUpdated, 1000);

  // âœ… Keep this â€” it updates the â€œLast updatedâ€ clock
  setInterval(updateLastUpdated, 1000);
});

/* ------------------------------------------------------------------
   Auth Functions (Firebase-based)
------------------------------------------------------------------ */
function handleRegister(event) {
  event.preventDefault();
  const email = document.getElementById('registerEmail').value;
  const password = document.getElementById('registerPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;

  if (!email.endsWith('@gmail.com')) {
    alert('Only Gmail accounts are allowed.');
    return;
  }

  if (password !== confirmPassword) {
    alert('Passwords do not match');
    return;
  }

  firebase.auth().createUserWithEmailAndPassword(email, password)
    .then((userCredential) => {
      const user = userCredential.user;
      user.sendEmailVerification();

      return firebase.database().ref('users/' + user.uid).set({
        email: user.email,
        createdAt: new Date().toISOString(),
      });
    })
    .then(() => {
      alert('âœ… Account created successfully! Check your Gmail to verify your account.');
      document.getElementById('registerForm').reset();
      switchAuthTab('login');
    })
    .catch((error) => {
      console.error(error);
      alert(error.message);
    });
}

function handleLogin(event) {
  event.preventDefault();
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;

  firebase.auth().signInWithEmailAndPassword(email, password)
    .then((userCredential) => {
      const user = userCredential.user;

      if (!user.emailVerified) {
        firebase.auth().signOut();
        alert('Please verify your Gmail before logging in.');
        return;
      }

      localStorage.setItem('currentUser', user.email);
      showDashboard();
    })
    .catch((error) => {
      console.error(error);
      alert(error.message);
    });
}
/* ------------------------------------------------------------------
   Helper UI Functions
------------------------------------------------------------------ */
function switchAuthTab(tab) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
  document.getElementById(tab + 'Form').classList.add('active');
  clearAuthMessages();
  
  lucide.createIcons();
}

function showAuthError(elementId, message) {
  const el = document.getElementById(elementId);
  el.querySelector('span').textContent = message;
  el.style.display = 'flex';
  lucide.createIcons();
}
function showAuthSuccess(elementId, message) {
  const el = document.getElementById(elementId);
  el.querySelector('span').textContent = message;
  el.style.display = 'flex';
  lucide.createIcons();
}
function clearAuthMessages() {
  document.querySelectorAll('.auth-error, .auth-success').forEach(el => el.style.display = 'none');
}

function showDashboard() {
  document.getElementById('authContainer').classList.add('hidden');
  document.getElementById('dashboardContainer').classList.add('visible');
}

/* ------------------------------------------------------------------
   Logout
------------------------------------------------------------------ */
function logout() {
  if (confirm('Are you sure you want to logout?')) {
    firebase.auth().signOut();
    currentUser = null;
    localStorage.removeItem('currentUser');
    document.getElementById('authContainer').classList.remove('hidden');
    document.getElementById('dashboardContainer').classList.remove('visible');
    document.querySelectorAll('.auth-form').forEach(f => f.reset());
    clearAuthMessages();
    switchAuthTab('login');
    document.querySelector('.auth-tab').click();
  }
}

/* ------------------------------------------------------------------
   Dashboard Logic (same as your original)
------------------------------------------------------------------ */
let peso1 = 0, peso5 = 0, peso10 = 0;
let waterLevel = 85;

function init() {
  updateDisplay();
  loadHistory();
  setWaterLevel(waterLevel);
}

function simulateRandomInserts() {
  if (currentUser && Math.random() > 0.92) {
    peso1 += Math.floor(Math.random() * 2);
    peso5 += Math.floor(Math.random() * 1);
    updateDisplay();
  }
}

// --- History helpers for real daily/weekly/monthly totals ---
function getRangeTotal(days) {
  const history = JSON.parse(localStorage.getItem('waterVendoHistory') || '[]');
  const now = new Date();
  const from = new Date(now);
  from.setDate(from.getDate() - (days - 1)); // e.g. 7 days = last 7 including today

  let total = 0;
  history.forEach(h => {
    const d = new Date(h.date);
    if (d >= from && d <= now) {
      total += h.total || 0;
    }
  });
  return total;
}

function updateDisplay() {
  const todayEarnings = peso1 * 1 + peso5 * 5 + peso10 * 10;
  const totalCoins    = peso1 + peso5 + peso10;

  // Basic coin displays
  document.getElementById('peso1Display').textContent = peso1;
  document.getElementById('peso5Display').textContent = peso5;
  document.getElementById('peso10Display').textContent = peso10;
  document.getElementById('peso1Total').textContent = peso1 * 1;
  document.getElementById('peso5Total').textContent = peso5 * 5;
  document.getElementById('peso10Total').textContent = peso10 * 10;
  document.getElementById('totalEarningsDisplay').textContent = 'â‚±' + todayEarnings;
  document.getElementById('totalCoins').textContent = totalCoins;

  // ---- REAL totals using saved history + current counters ----
  const dailyHistory   = getRangeTotal(1);
  const weeklyHistory  = getRangeTotal(7);
  const monthlyHistory = getRangeTotal(30);

  document.getElementById('dailyTotal').textContent   = 'â‚±' + (dailyHistory   + todayEarnings);
  document.getElementById('weeklyTotal').textContent  = 'â‚±' + (weeklyHistory  + todayEarnings);
  document.getElementById('monthlyTotal').textContent = 'â‚±' + (monthlyHistory + todayEarnings);

  // Sales breakdown
  document.getElementById('sales1Count').textContent = peso1;
  document.getElementById('sales5Count').textContent = peso5;
  document.getElementById('sales10Count').textContent = peso10;
  document.getElementById('sales1Value').textContent = 'â‚±' + (peso1 * 1);
  document.getElementById('sales5Value').textContent = 'â‚±' + (peso5 * 5);
  document.getElementById('sales10Value').textContent = 'â‚±' + (peso10 * 10);

  const denomTotal = todayEarnings || 1; // avoid divide-by-zero

  document.getElementById('sales1Percent').textContent  =
    Math.round((peso1 * 1  / denomTotal) * 100) + '%';
  document.getElementById('sales5Percent').textContent  =
    Math.round((peso5 * 5  / denomTotal) * 100) + '%';
  document.getElementById('sales10Percent').textContent =
    Math.round((peso10 * 10 / denomTotal) * 100) + '%';

  document.getElementById('salesTotalCount').textContent = totalCoins;
  document.getElementById('salesTotalValue').textContent = 'â‚±' + todayEarnings;
}

/* ------------------------------------------------------------------
   Water level and history (unchanged)
------------------------------------------------------------------ */
function setWaterLevel(level) {
  waterLevel = level;
  const progressBar = document.getElementById('waterProgressBar');
  const levelDisplay = document.getElementById('waterLevelDisplay');
  const statusText = document.getElementById('waterStatusText');
  const statusIcon = document.getElementById('waterStatusIcon');
  const alertContainer = document.getElementById('waterAlert');

  progressBar.style.width = level + '%';
  progressBar.textContent = level + '%';
  levelDisplay.textContent = level + '%';

  let status, statusClass, iconName;
  if (level > 30) {
    status = 'normal'; statusClass = 'text-green'; iconName = 'check-circle';
    progressBar.className = 'progress-bar';
  } else if (level > 10) {
    status = 'low'; statusClass = 'text-orange'; iconName = 'alert-triangle';
    progressBar.className = 'progress-bar low';
  } else {
    status = 'empty'; statusClass = 'text-red'; iconName = 'alert-triangle';
    progressBar.className = 'progress-bar empty';
  }
  statusText.textContent = 'Status: ' + status;
  statusText.className = statusClass;
  levelDisplay.className = 'card-value ' + statusClass;
  statusIcon.setAttribute('data-lucide', iconName);
  statusIcon.className = statusClass;
  lucide.createIcons();

  if (status !== 'normal') {
    const alertClass = status === 'low' ? 'alert-warning' : 'alert-danger';
    const alertTitle = status === 'low' ? 'Low Water Level Warning' : 'Critical: Empty Tank';
    const alertMessage = status === 'low'
      ? 'Water level is below 30%. Consider refilling soon.'
      : 'Tank is empty or critically low. Immediate attention required.';
    alertContainer.innerHTML = `
      <div class="alert ${alertClass}">
        <i data-lucide="alert-triangle"></i>
        <div>
          <h4 style="font-weight:500;margin-bottom:4px;">${alertTitle}</h4>
          <p style="font-size:14px;">${alertMessage}</p>
        </div>
      </div>`;
    lucide.createIcons();
  } else alertContainer.innerHTML = '';
}

function updateLastUpdated() {
  if (currentUser) {
    document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
  }
}

/* ------------------------------------------------------------------
   Section Navigation Logic
------------------------------------------------------------------ */
function showSection(sectionId, element) {
  // Hide all sections
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));

  // Show the selected section
  const target = document.getElementById(sectionId);
  if (target) {
    target.classList.add('active');
  }

  // Update active sidebar highlight
  document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
  if (element) element.classList.add('active');

  // Close sidebar on mobile
  closeSidebar?.();

  // Re-render icons
  lucide.createIcons();
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.querySelector('.overlay').classList.toggle('active');
}

function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.querySelector('.overlay').classList.remove('active');
}
/* ðŸ”§ Handle Forgot Password */
/* ðŸ”§ Handle Forgot Password */
function handleForgotPassword(event) {
  event.preventDefault();

  const email = document.getElementById('forgotEmail').value;

  if (!email) {
    alert("Please enter your Gmail address.");
    return;
  }

  firebase.auth().sendPasswordResetEmail(email)
    .then(() => {
      alert(`Password reset email sent to ${email}. Please check your inbox.`);
      document.getElementById('forgotForm').reset();
      switchAuthTab('login'); // Go back to login tab after sending
    })
    .catch((error) => {
      console.error("Error sending reset email:", error);
      alert(error.message);
    });
}

/* ðŸ”„ Reset counters: save to history + reset Firebase + UI */
function resetCounters() {
  const totalEarnings = peso1 * 1 + peso5 * 5 + peso10 * 10;

  if (totalEarnings <= 0) {
    alert('No earnings to reset.');
    return;
  }

  if (!confirm('Save current totals to history and reset counters?')) {
    return;
  }

  // Save current totals into local history
  let history = JSON.parse(localStorage.getItem('waterVendoHistory') || '[]');
  history.push({
    date: new Date().toISOString(),
    p1: peso1,
    p5: peso5,
    p10: peso10,
    total: totalEarnings
  });
  localStorage.setItem('waterVendoHistory', JSON.stringify(history));

  // Reset values in Firebase so ESP32 + dashboard stay in sync
  db.ref(`machines/${machineId}/coins`).set({
    p1: 0,
    p5: 0,
    p10: 0
  }).then(() => {
    // Reset local counters + UI
    peso1 = 0;
    peso5 = 0;
    peso10 = 0;
    updateDisplay();
    loadHistory();
    alert('Counters have been reset.');
  }).catch((error) => {
    console.error('Failed to reset in Firebase:', error);
    alert('Failed to reset in cloud: ' + error.message);
  });
}

/* ðŸ“œ Load history table from localStorage */
function loadHistory() {
  const history = JSON.parse(localStorage.getItem('waterVendoHistory') || '[]');
  const emptyHistory = document.getElementById('emptyHistory');
  const historyTable = document.getElementById('historyTable');
  const historyTableBody = document.getElementById('historyTableBody');

  if (!history.length) {
    emptyHistory.style.display = 'block';
    historyTable.style.display = 'none';
    return;
  }

  emptyHistory.style.display = 'none';
  historyTable.style.display = 'table';
  historyTableBody.innerHTML = '';

  history.forEach(entry => {
    const row = document.createElement('tr');
    const niceDate = new Date(entry.date).toLocaleString();
    row.innerHTML = `
      <td><i data-lucide="calendar" style="width:16px;height:16px;color:#9ca3af;margin-right:8px;"></i>${niceDate}</td>
      <td style="text-align:right;">${entry.p1}</td>
      <td style="text-align:right;">${entry.p5}</td>
      <td style="text-align:right;">${entry.p10}</td>
      <td style="text-align:right;color:#059669;font-weight:500;">â‚±${entry.total}</td>
    `;
    historyTableBody.appendChild(row);
  });

  lucide.createIcons();
}

/* ðŸ—‘ Clear history */
function clearHistory() {
  if (!confirm('Are you sure you want to clear all history?')) return;
  localStorage.removeItem('waterVendoHistory');
  loadHistory();
  updateDisplay();
}

/* â¬‡ Export history as CSV */
function exportHistory() {
  const history = JSON.parse(localStorage.getItem('waterVendoHistory') || '[]');

  if (!history.length) {
    alert('No history to export yet.');
    return;
  }

  let csv = 'Date,â‚±1 Coins,â‚±5 Coins,â‚±10 Coins,Total\n';
  history.forEach(h => {
    const niceDate = new Date(h.date).toLocaleString().replace(/"/g, '""');
    csv += `"${niceDate}",${h.p1},${h.p5},${h.p10},${h.total}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'water-vendo-history.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}


function exportHistory() {
  const history = JSON.parse(localStorage.getItem('waterVendoHistory') || '[]');

  if (!history.length) {
    alert('No history to export yet.');
    return;
  }

  let csv = 'Date,â‚±1 Coins,â‚±5 Coins,â‚±10 Coins,Total\n';
  history.forEach(h => {
    const niceDate = new Date(h.date).toLocaleString().replace(/"/g, '""');
    csv += `"${niceDate}",${h.p1},${h.p5},${h.p10},${h.total}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'water-vendo-history.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

</script>

</body>
</html>
